<!DOCTYPE html><html lang="zh-Hant"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>å®‰æ‹“å¯¦æ¥­æœ‰é™å…¬å¸ï½œANCHOR FASTENERS INDUSTRIAL CO.,LTD.ï½œå“æª¢å ±å‘Š</title><style>
*{box-sizing:border-box}body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;margin:0;background:#fff;color:#111}.wrap{max-width:1000px;margin:0 auto;padding:24px 16px 48px}header{display:flex;align-items:flex-end;justify-content:space-between;border-bottom:2px solid #111;padding-bottom:12px;margin-bottom:12px}.brand{font-weight:700;font-size:18px;line-height:1.2}.brand small{display:block;color:#374151}.title{font-size:18px;font-weight:600}.toolbar{display:flex;gap:8px;align-items:center;margin:8px 0}.btn{padding:9px 12px;border:none;border-radius:10px;background:#2563eb;color:#fff;cursor:pointer}.btn.out{background:#e5e7eb;color:#111}.block{border:1px solid #e5e7eb;border-radius:10px;padding:12px;margin-top:8px}.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}.muted{color:#6b7280;font-size:12px}table{width:100%;border-collapse:collapse;margin-top:6px}th,td{border:1px solid #e5e7eb;padding:8px;text-align:left;vertical-align:top}th{background:#f3f4f6}.result{font-weight:700}.pass{color:#116329}.fail{color:#c02020}.sign{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}.cell{border:1px solid #e5e7eb;border-radius:10px;padding:8px;height:80px}.cell small{display:block;color:#6b7280;margin-bottom:6px}@media print{.noprint{display:none}.wrap{padding:8px 0}}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:50}.panel{background:#fff;border-radius:14px;padding:16px;width:360px;box-shadow:0 10px 25px rgba(0,0,0,.15)}.lang-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}.lang-btn{padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#f9fafb;cursor:pointer}.hidden{display:none!important}
</style></head><body><div class="wrap">
<header>
  <div class="brand">å®‰æ‹“å¯¦æ¥­æœ‰é™å…¬å¸<small>ANCHOR FASTENERS INDUSTRIAL CO.,LTD.</small></div>
  <div class="title">å“æª¢å ±å‘Š Inspection Report</div>
</header>
<div class="toolbar noprint">
  <button class="btn" id="btnPrint">åˆ—å° / ä¸‹è¼‰ PDF</button>
  <a class="btn out" href="report.html">è¿”å›åˆ—è¡¨</a>
  <button class="btn out" id="btnLang">ğŸŒ èªè¨€</button>
  <span class="muted" id="tip"></span>
</div>

<div class="block"><h3>åŸºæœ¬è³‡è¨Š</h3>
  <div class="row">
    <div><strong>å ±å‘Šç·¨è™Ÿï¼š</strong><span id="f-id"></span></div>
    <div><strong>æª¢é©—æ™‚é–“ï¼š</strong><span id="f-time"></span></div>
    <div><strong>æª¢é©—äººå“¡ï¼š</strong><span id="f-inspector"></span></div>
    <div><strong>æª¢é©—çµæœï¼š</strong><span id="f-overall" class="result"></span></div>
  </div>
</div>

<div class="block"><h3>æ–™ä»¶è³‡è¨Š</h3>
  <div class="row">
    <div><strong>ä¾›æ‡‰å•†ï¼š</strong><span id="f-supplier"></span></div>
    <div><strong>è£½ç¨‹ï¼š</strong><span id="f-process"></span></div>
    <div><strong>æ–™è™Ÿï¼š</strong><span id="f-part"></span></div>
    <div><strong>åœ–è™Ÿï¼š</strong><span id="f-draw"></span></div>
    <div><strong>ç‰ˆæ¬¡ï¼š</strong><span id="f-rev"></span></div>
  </div>
  <div style="margin-top:6px"><strong>å‚™è¨»ï¼š</strong><span id="f-notes"></span></div>
</div>

<div class="block"><h3>å¤–è§€èˆ‡é‡æ¸¬æ˜ç´°</h3><div id="unified"></div></div>

<div class="block"><h3>ç°½æ ¸</h3>
  <div class="sign">
    <div class="cell"><small>æª¢é©—äººå“¡</small><div id="sign-inspector"></div></div>
    <div class="cell"><small>å“ä¿ä¸»ç®¡</small></div>
    <div class="cell"><small>æ ¸å‡†</small></div>
  </div>
</div>
</div>

<div id="langModal" class="modal hidden"><div class="panel"><h3>é¸æ“‡èªè¨€</h3>
  <div class="lang-grid"><button class="lang-btn" data-lang="zh-Hant">ç¹é«”</button><button class="lang-btn" data-lang="zh-Hans">ç®€ä½“</button><button class="lang-btn" data-lang="en">English</button></div>
</div></div>

<script>
const tip=document.getElementById('tip'); const ID=new URLSearchParams(location.search).get('id')||""; let curr=null;
document.getElementById('btnPrint').onclick=()=>window.print();
document.getElementById('btnLang').onclick=()=>document.getElementById('langModal').classList.remove('hidden');
document.getElementById('langModal').addEventListener('click',e=>{if(e.target.dataset.lang){localStorage.setItem('qci_lang',e.target.dataset.lang);document.getElementById('langModal').classList.add('hidden');renderUnified();} if(e.target.id==='langModal')e.currentTarget.classList.add('hidden')});

function esc(s){return String(s||"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
function fmt3(v){return (v===0||v)?Number(v).toFixed(3):""}
function getLang(){const s=localStorage.getItem('qci_lang');return["zh-Hant","zh-Hans","en"].includes(s)?s:"zh-Hant"}
function tAppearance(){return{ "zh-Hant":"å¤–è§€","zh-Hans":"å¤–è§‚","en":"Appearance" }[getLang()]||"Appearance"}
function tHead(){const L=getLang();const map={ "zh-Hant":["é …ç›®/å°ºå¯¸","åç›®","ä¸‹é™å…¬å·®","ä¸Šé™å…¬å·®","æ¨£å“/å¯¦æ¸¬1","æ¨£å“/å¯¦æ¸¬2","æ¨£å“/å¯¦æ¸¬3","æ¨£å“/å¯¦æ¸¬4","æ¨£å“/å¯¦æ¸¬5","åˆ¤å®š"], "zh-Hans":["é¡¹ç›®/å°ºå¯¸","åä¹‰","ä¸‹é™å…¬å·®","ä¸Šé™å…¬å·®","æ ·å“/å®æµ‹1","æ ·å“/å®æµ‹2","æ ·å“/å®æµ‹3","æ ·å“/å®æµ‹4","æ ·å“/å®æµ‹5","åˆ¤å®š"], "en":["Item/Dim.","Nominal","Lower Tol.","Upper Tol.","Sample/Meas.1","Sample/Meas.2","Sample/Meas.3","Sample/Meas.4","Sample/Meas.5","Judgement"]}; return map[L]||map["zh-Hant"]; }
function fmtOKNG(v){const L=getLang();const s=String(v||"").toUpperCase();if(s==="OK")return L==="en"?"OK":"O.K"; if(s==="NG")return "NG"; return "";}
function listFromJson(x){if(Array.isArray(x))return x.length&&x[0]&&x[0].record&&x[0].record.record?x[0].record.record:x; if(x&&Array.isArray(x.record))return x.record; return[]}
function buildUnified(ap=listAppearance(),ms=listMeasures()){
  const H=tHead(); let thead=`<thead><tr>${H.map(h=>`<th>${h}</th>`).join('')}</tr></thead>`;
  let rows="";
  if(ap.has){rows+=`<tr><td><strong>${tAppearance()}</strong></td><td></td><td></td><td></td>${ap.cells.map(x=>`<td>${x}</td>`).join('')}<td>${ap.pass?'PASS':'FAIL'}</td></tr>`}
  rows+=ms.map(m=>`<tr><td>${esc(m.name||'')}</td><td>${fmt3(m.nominal)}</td><td>${fmt3(m.tolMinus)}</td><td>${fmt3(m.tolPlus)}</td>${m.mcells.map(x=>`<td>${x}</td>`).join('')}<td>${m.dec}</td></tr>`).join('');
  return rows?`<table>${thead}<tbody>${rows}</tbody></table>`:'<div class="muted">ï¼ˆç„¡æ˜ç´°ï¼‰</div>';
}
function listAppearance(){const ap=Array.isArray(curr?.appearance)?curr.appearance:[]; const map={}; for(const a of ap){const m=String(a.sample||"").match(/(\d+)/);const i=m?Number(m[1]):null; if(i&&i>=1&&i<=5) map[i]=fmtOKNG(a.result);} const cells=[1,2,3,4,5].map(i=>esc(map[i]||"")); const has=Object.keys(map).length>0; const pass=has&&Object.values(map).every(v=>v==="OK"||v==="O.K"); return {has,cells,pass};}
function listMeasures(){const L=Array.isArray(curr?.measurements)?curr.measurements:[]; return L.map(m=>{const arr=Array.isArray(m.measured)?m.measured:((typeof m.measured==='number'||(typeof m.measured==='string'&&m.measured!==''))?[m.measured]:[]); const mc=[0,1,2,3,4].map(i=>fmt3(arr[i])); const dec=typeof m.pass==='boolean'?(m.pass?'PASS':'FAIL'):esc(String(m.decision||'')); return {name:m.name,nominal:m.nominal,tolMinus:m.tolMinus,tolPlus:m.tolPlus,mcells:mc,dec};});}
function renderUnified(){document.getElementById('unified').innerHTML=buildUnified();}
async function ensureAuth(){let u=localStorage.getItem('qci_user')||"",p=localStorage.getItem('qci_pass')||"";if(!u||!p){u=prompt('å¸³è™Ÿ')||"";p=prompt('å¯†ç¢¼')||"";if(!u||!p)return!1;localStorage.setItem('qci_user',u);localStorage.setItem('qci_pass',p)}try{const r=await fetch('/api/inspections?auth=1',{headers:{'x-user':u,'x-pass':p,'x-passcode':p}});const t=await r.text();let j={};try{j=JSON.parse(t)}catch{} return r.ok&&j.ok&&["admin","viewer"].includes((j.role||"").toLowerCase())}catch{return!1}}
async function load(){tip.textContent='è®€å–ä¸­...'; try{const u=localStorage.getItem('qci_user')||"",p=localStorage.getItem('qci_pass')||"";const r=await fetch('/api/inspections',{headers:{'x-user':u,'x-pass':p,'x-passcode':p}});const t=await r.text();if(!r.ok)throw new Error(t||('HTTP '+r.status)); let j={};try{j=JSON.parse(t)}catch{j=[]} const list=listFromJson(j); curr=list.find(x=>String(x.id||'')===ID)||null; if(!curr){tip.textContent='æ‰¾ä¸åˆ°è³‡æ–™';return;}
  // åŸºæœ¬+æ–™ä»¶
  document.getElementById('f-id').textContent=curr.id||''; document.getElementById('f-time').textContent=curr.timestamp?new Date(curr.timestamp).toLocaleString():''; document.getElementById('f-inspector').textContent=curr.inspector||''; document.getElementById('f-overall').textContent=(curr.overallResult||''); document.getElementById('f-overall').className='result '+((curr.overallResult||'')==='PASS'?'pass':'fail');
  document.getElementById('f-supplier').textContent=curr.supplier||''; document.getElementById('f-process').textContent=curr.process||''; document.getElementById('f-part').textContent=curr.partNo||''; document.getElementById('f-draw').textContent=curr.drawingNo||''; document.getElementById('f-rev').textContent=curr.revision||''; document.getElementById('f-notes').textContent=curr.notes||'';
  document.getElementById('sign-inspector').textContent=curr.inspector||''; // ç°½æ ¸å€å¸¶å…¥æª¢é©—äººå“¡
  renderUnified(); tip.textContent=''; }catch(e){tip.textContent='âŒ è¼‰å…¥å¤±æ•—ï¼š'+(e.message||e)}}
(async()=>{const ok=await ensureAuth(); if(!ok){alert('æœªæˆæ¬Šæˆ–ç™»å…¥å¤±æ•—');location.href='index.html';return;} await load();})();
</script>
</body></html>
